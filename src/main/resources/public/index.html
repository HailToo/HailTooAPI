<html>
  <head>
	<link rel="stylesheet" href="css/modal.css">
  
  
  	<script src="lib/crafty-min.js"></script>
  	<script src="lib/jquery-3.1.0.min.js"></script>
  	<script src="app/app.js"></script>
  	<script src="app/components.js"></script>
  	<script src="app/services/GameService.js"></script>
  	<script src="app/helpers/NotificationHelper.js"></script>
  	<script src="app/helpers/CraftyHelper.js"></script>
  	<script>window.addEventListener('load', Game.init);</script>
  	<script type="text/javascript">
  		$(document).ready(function() {
  			console.log("loaded.");
  			
  			//Show current version
  			NotificationHelper.modalAlert("HailToo " + GameService.getVersion(), 5000);
  			
  			Game._user.name = window.prompt("Enter username", "");
  			var authToken = GameService.login({ username: Game._user.name }).done(function(data) {
  				console.log("Auth token received: " + data.token);
  	  			GameService.setAuthToken(data.token);	
  			});
  			
  			GameService.characters().done(function(data) {
  				document.characters = data;
  			});
  			
  			$( "#create" ).click(function() {
  				document.gameGuid = GameService.newGame();
  				console.log("Game ID: " + document.gameGuid);
  				$('#join').click();
  			});
  			
  			$( "#join" ).click(function() {
  				// TODO: Prompt user to pick from list.
  				var gameGuid = window.prompt("Enter game id", document.gameGuid);
  				GameService.getGameState(gameGuid).done(function(data) {
  					document.gameState = data;
  					
  					//Determine which characters are available to choose from
  					var availableCharacters = document.characters;
  					data.players.forEach(function(p) {
  						//Remove any character from available list if it's already taken
  						if(availableCharacters.indexOf(p.character) >= 0) {
  							availableCharacters.splice(availableCharacters.indexOf(p.character), 1);
  						}
  					});
  					
  					//Prompt user for character choice
  					var characterName = window.prompt("Pick a character", availableCharacters[0]);
  					Game._user.character = characterName;
  					console.log("character choice: " + characterName);
  	  				
  					GameService.joinGame(gameGuid, characterName).done(function(data) {			  
						Game.pollGameState();
  	  				});
  				});
  			});
  			
  			$( "#get" ).click(function() {
  				GameService.getGameState(document.gameState.name).done(function(data) {
  				  console.log("reply: " + JSON.stringify(data));
  				});
  			});
  			
  			$( "#start" ).click(function() {
  				GameService.start(document.gameState.name).done(function(data) {
  				  console.log("reply: " + JSON.stringify(data));
  				});

  			});
  		});
  	</script>
  </head>
  <body>
  	<h1 id="title"></h1>
  	<div id="modalDialog" class="modal-content">
	  <div class="modal-body">
	    <span class="close">Ã—</span>
	    <p>Modal body</p>
	  </div>
	</div>
    <div id="game"></div>
    <!--  TODO: <div id="playerInfo" style="width:300px;height:300px;border:1px solid black;">info panel</div> -->
    <div id="hand"></div>
  </body>
  <footer>
  	<button id="create">Create</button>
  	<button id="join">Join Game</button>
  	<button id="get">Get Game</button>
  	<button id="start">Start Game</button>
  </footer>
</html>
